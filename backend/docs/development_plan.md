# 智能投顾系统 - 开发计划文档

## 项目概述

智能投顾系统是一个数据驱动、AI赋能的下一代智能投顾平台，旨在为基金公司及其客户提供高度个性化、动态、透明且合规的投资决策支持服务。

## 已完成任务 ✅

### 阶段一：基础架构搭建
- ✅ **任务 1.1**: 数据库模型设计 (Feature, Portfolio, Strategy)
- ✅ **任务 1.2**: FastAPI 基础路由搭建
- ✅ **任务 1.3**: Pydantic 数据验证模型
- ✅ **任务 1.4**: 基础 CRUD 操作实现

### 阶段二：特征工程模块增强
- ✅ **任务 2.1**: 增强特征名称验证
  - 实现中文、英文、数字、下划线、中划线支持
  - 添加长度限制 (1-100字符)
  - 禁止数字开头和特殊字符结尾
  - 自动去除首尾空格
  - 完整的测试覆盖

## 待开发任务 📋

### 阶段二：特征工程模块增强 (继续)

#### **任务 2.2: 添加特征版本格式验证** 🔄
- **目标**: 实现语义化版本控制 (Semantic Versioning)
- **功能**:
  - 支持格式: `v1.0.0`, `v2.1.3` 等
  - 验证主版本号、次版本号、修订号
  - 支持预发布版本: `v1.0.0-alpha.1`
  - 支持构建元数据: `v1.0.0+build.1`
- **技术实现**:
  - 使用正则表达式验证版本格式
  - 添加版本比较功能
  - 更新 Pydantic 验证器
- **测试覆盖**:
  - 有效版本格式测试
  - 无效版本格式测试
  - 版本比较测试
- **预估时间**: 2-3小时

#### **任务 2.3: 添加特征类型枚举** 🔄
- **目标**: 定义标准化的特征类型
- **功能**:
  - 预定义类型: 数值型、分类型、文本型、时间型
  - 支持自定义类型扩展
  - 类型验证和约束
- **技术实现**:
  - 使用 Python Enum 定义类型
  - 更新 Pydantic 模型
  - 添加类型验证逻辑
- **测试覆盖**:
  - 有效类型测试
  - 无效类型测试
  - 类型转换测试
- **预估时间**: 1-2小时

#### **任务 2.4: 特征血缘关系管理** 🔄
- **目标**: 实现特征依赖关系追踪
- **功能**:
  - 记录特征来源和依赖
  - 支持多级依赖关系
  - 血缘关系可视化
- **技术实现**:
  - 扩展数据库模型
  - 添加血缘解析逻辑
  - 实现依赖检查
- **测试覆盖**:
  - 血缘关系创建测试
  - 循环依赖检测测试
  - 血缘查询测试
- **预估时间**: 3-4小时

### 阶段三：投资组合管理模块

#### **任务 3.1: 投资组合基础功能** 🔄
- **目标**: 实现投资组合的创建和管理
- **功能**:
  - 投资组合创建、更新、删除
  - 资产权重分配
  - 组合基本信息管理
- **技术实现**:
  - 完善 Portfolio 模型
  - 实现组合 CRUD 操作
  - 添加权重验证逻辑
- **预估时间**: 2-3小时

#### **任务 3.2: 投资组合风险分析** 🔄
- **目标**: 实现基础风险指标计算
- **功能**:
  - 夏普比率计算
  - 最大回撤分析
  - 波动率计算
  - 相关性分析
- **技术实现**:
  - 集成 NumPy/Pandas 进行数值计算
  - 实现风险指标算法
  - 添加历史数据模拟
- **预估时间**: 4-5小时

#### **任务 3.3: 投资组合优化** 🔄
- **目标**: 实现现代投资组合理论优化
- **功能**:
  - 有效前沿计算
  - 风险预算分配
  - 约束条件处理
- **技术实现**:
  - 集成 SciPy 优化库
  - 实现 Markowitz 模型
  - 添加约束优化算法
- **预估时间**: 5-6小时

### 阶段四：策略引擎模块

#### **任务 4.1: 策略基础框架** 🔄
- **目标**: 构建策略执行引擎
- **功能**:
  - 策略定义和注册
  - 策略参数管理
  - 策略执行调度
- **技术实现**:
  - 设计策略接口
  - 实现策略管理器
  - 添加参数验证
- **预估时间**: 3-4小时

#### **任务 4.2: 回测引擎** 🔄
- **目标**: 实现策略回测功能
- **功能**:
  - 历史数据回放
  - 交易信号生成
  - 绩效评估
- **技术实现**:
  - 集成 Backtrader 或自建回测框架
  - 实现数据时间序列处理
  - 添加绩效指标计算
- **预估时间**: 6-8小时

#### **任务 4.3: 实时策略执行** 🔄
- **目标**: 实现实时策略监控和执行
- **功能**:
  - 实时数据接入
  - 策略信号生成
  - 风险监控
- **技术实现**:
  - 集成 WebSocket 实时数据
  - 实现事件驱动架构
  - 添加风险控制机制
- **预估时间**: 4-5小时

### 阶段五：风险管理模块

#### **任务 5.1: 风险指标计算** 🔄
- **目标**: 实现全面的风险指标
- **功能**:
  - VaR (在险价值) 计算
  - CVaR (条件在险价值) 计算
  - 压力测试
  - 情景分析
- **技术实现**:
  - 集成 QuantLib 金融库
  - 实现蒙特卡洛模拟
  - 添加历史模拟法
- **预估时间**: 5-6小时

#### **任务 5.2: 风险监控仪表板** 🔄
- **目标**: 构建实时风险监控界面
- **功能**:
  - 风险指标可视化
  - 实时风险预警
  - 风险报告生成
- **技术实现**:
  - 集成 Plotly/Dash 可视化
  - 实现实时数据推送
  - 添加预警机制
- **预估时间**: 4-5小时

### 阶段六：用户界面模块

#### **任务 6.1: 前端基础架构** 🔄
- **目标**: 搭建 React 前端框架
- **功能**:
  - 路由系统
  - 状态管理
  - 组件库
- **技术实现**:
  - 使用 React Router
  - 集成 Redux/Zustand
  - 使用 Ant Design/Material-UI
- **预估时间**: 3-4小时

#### **任务 6.2: 特征管理界面** 🔄
- **目标**: 实现特征管理的前端界面
- **功能**:
  - 特征列表展示
  - 特征创建/编辑表单
  - 特征搜索和筛选
- **技术实现**:
  - 实现 CRUD 界面
  - 添加表单验证
  - 集成搜索功能
- **预估时间**: 4-5小时

#### **任务 6.3: 投资组合管理界面** 🔄
- **目标**: 实现投资组合管理界面
- **功能**:
  - 组合创建和编辑
  - 资产配置可视化
  - 绩效展示
- **技术实现**:
  - 集成图表库 (ECharts/Chart.js)
  - 实现拖拽式资产配置
  - 添加实时数据更新
- **预估时间**: 5-6小时

## 优先级建议 🎯

### 高优先级 (核心功能)
1. **任务 2.2**: 特征版本格式验证
2. **任务 2.3**: 特征类型枚举
3. **任务 3.1**: 投资组合基础功能
4. **任务 4.1**: 策略基础框架

### 中优先级 (增强功能)
1. **任务 2.4**: 特征血缘关系管理
2. **任务 3.2**: 投资组合风险分析
3. **任务 5.1**: 风险指标计算
4. **任务 6.1**: 前端基础架构

### 低优先级 (完善功能)
1. **任务 3.3**: 投资组合优化
2. **任务 4.2**: 回测引擎
3. **任务 4.3**: 实时策略执行
4. **任务 5.2**: 风险监控仪表板
5. **任务 6.2**: 特征管理界面
6. **任务 6.3**: 投资组合管理界面

## 技术栈总结 🛠️

### 后端技术栈
- **Web框架**: FastAPI
- **数据库**: SQLAlchemy + SQLite/PostgreSQL
- **数据验证**: Pydantic v2
- **数值计算**: NumPy, Pandas, SciPy
- **金融计算**: QuantLib
- **回测框架**: Backtrader/Zipline

### 前端技术栈
- **框架**: React 18
- **状态管理**: Redux Toolkit/Zustand
- **路由**: React Router v6
- **UI组件**: Ant Design/Material-UI
- **图表**: ECharts/Chart.js
- **实时通信**: WebSocket

### 开发工具
- **测试**: pytest, TestClient
- **文档**: FastAPI 自动文档
- **代码质量**: Black, isort, mypy
- **版本控制**: Git

## 当前问题修复 🔧

### 问题：Features 页面显示空白
**原因分析**:
1. 前端导入路径问题
2. 后端 API 响应格式与前端期望不匹配

**解决方案**:
1. 修复 App.jsx 中的导入路径
2. 调整前端代码以适配后端的分页响应格式

**修复状态**: ✅ 已修复

## 下一步建议 🚀

建议从 **任务 2.2: 特征版本格式验证** 开始，因为：
1. 这是特征工程模块的自然延续
2. 技术复杂度适中，可以快速完成
3. 为后续的特征管理提供重要基础
4. 测试覆盖容易实现

## 开发规范 📝

### 代码质量
- 使用 Black 进行代码格式化
- 使用 isort 进行导入排序
- 使用 mypy 进行类型检查
- 保持 90% 以上的测试覆盖率

### 提交规范
- 使用语义化提交信息
- 每个任务完成后进行代码审查
- 保持提交粒度适中，便于回滚

### 文档规范
- 每个模块都要有 README 文档
- API 文档使用 FastAPI 自动生成
- 代码注释要清晰明了 