# 资产批量标签管理 API 文档

## 1. 批量为多个资产添加标签

### 路径
POST /assets/tags

### 权限要求
- 需登录（JWT/OAuth2）

### 请求参数
- data: List[dict]
    - 每项格式：
        - asset_id: int  # 资产ID
        - tags: List[str]  # 要添加的标签名列表
    - 允许同一资产多次出现，所有标签会自动合并去重。

#### 示例
```json
[
    {"asset_id": 1, "tags": ["科技", "热门"]},
    {"asset_id": 2, "tags": ["蓝筹"]},
    {"asset_id": 1, "tags": ["蓝筹"]}
]
```

### 返回值
- List[dict]
    - 每项格式：
        - asset_id: int
        - tags: List[str]  # 该资产最新的全部标签

#### 示例
```json
[
    {"asset_id": 1, "tags": ["科技", "热门", "蓝筹"]},
    {"asset_id": 2, "tags": ["蓝筹"]}
]
```

### 常见错误响应
- 400 参数校验失败: {"detail": "asset_id 必须为正整数"}
- 400 参数校验失败: {"detail": "tags 必须为非空字符串列表"}
- 500 数据库异常: {"detail": "数据库错误: ..."}

### 安全建议
- 推荐集成速率限制（如Redis限流），防止恶意批量操作。
- 严格使用ORM和参数化，防止SQL注入。
- 权限校验，防止越权。
- 日志审计，输入校验防XSS。

### 性能优化方向
- 大批量/高并发建议用批量SQL、分批、异步队列。
- 数据库索引优化。
- 极大批量建议前端分批，后端异步。
- 监控慢查询和锁。

### 幂等性说明
- 同一资产、同一标签多次添加不会重复。
- 同一请求中同一资产/标签多次出现自动去重。
- 重复请求无副作用。
- 例：`[{"asset_id": 1, "tags": ["A", "A", "B"]}, {"asset_id": 1, "tags": ["B"]}]` 等价于 `[{"asset_id": 1, "tags": ["A", "B"]}]`

### 国际化建议
- 错误信息可结合Accept-Language头多语言返回。
- 标签名可多语言字段（如 name_en, name_zh）。
- 统一错误码和多语言消息映射。

### 依赖关系
- 数据库（PostgreSQL/SQLite等）
- 用户认证（JWT/OAuth2）
- 可选缓存（Redis）
- FastAPI依赖注入

### 团队协作与文档维护建议
- 接口变更需同步更新docstring和OpenAPI文档。
- 代码评审关注文档同步。
- 推荐自动化文档工具（Swagger/Sphinx等）。
- 贡献新特性/修复bug时补充文档。
- 重要接口建议配套示例和FAQ。

### 可扩展性建议
- 支持更多批量操作（如标签合并/转移/重命名）可用 action 参数、命令模式、插件机制。
- 批量操作逻辑可解耦为独立服务。
- 操作类型和参数建议在OpenAPI中详细说明。

---

## 2. 批量为多个资产移除标签

### 路径
POST /assets/tags/remove

### 权限要求
- 需登录（JWT/OAuth2）

### 请求参数
- data: List[dict]
    - 每项格式：
        - asset_id: int  # 资产ID
        - tags: List[str]  # 要移除的标签名列表
    - 允许同一资产多次出现，所有标签会自动合并去重。

#### 示例
```json
[
    {"asset_id": 1, "tags": ["科技", "热门"]},
    {"asset_id": 2, "tags": ["蓝筹"]},
    {"asset_id": 1, "tags": ["蓝筹"]}
]
```

### 返回值
- List[dict]
    - 每项格式：
        - asset_id: int
        - tags: List[str]  # 该资产最新的全部标签

#### 示例
```json
[
    {"asset_id": 1, "tags": []},
    {"asset_id": 2, "tags": []}
]
```

### 常见错误响应
- 400 参数校验失败: {"detail": "asset_id 必须为正整数"}
- 400 参数校验失败: {"detail": "tags 必须为非空字符串列表"}
- 500 数据库异常: {"detail": "数据库错误: ..."}

### 安全建议
- 推荐集成速率限制（如Redis限流），防止恶意批量操作。
- 严格使用ORM和参数化，防止SQL注入。
- 权限校验，防止越权。
- 日志审计，输入校验防XSS。

### 性能优化方向
- 大批量/高并发建议用批量SQL、分批、异步队列。
- 数据库索引优化。
- 极大批量建议前端分批，后端异步。
- 监控慢查询和锁。

### 幂等性说明
- 同一资产、同一标签多次移除不会异常。
- 同一请求中同一资产/标签多次出现自动去重。
- 重复请求无副作用。
- 例：`[{"asset_id": 1, "tags": ["A", "A", "B"]}, {"asset_id": 1, "tags": ["B"]}]` 等价于 `[{"asset_id": 1, "tags": ["A", "B"]}]`

### 国际化建议
- 错误信息可结合Accept-Language头多语言返回。
- 标签名可多语言字段（如 name_en, name_zh）。
- 统一错误码和多语言消息映射。

### 依赖关系
- 数据库（PostgreSQL/SQLite等）
- 用户认证（JWT/OAuth2）
- 可选缓存（Redis）
- FastAPI依赖注入

### 团队协作与文档维护建议
- 接口变更需同步更新docstring和OpenAPI文档。
- 代码评审关注文档同步。
- 推荐自动化文档工具（Swagger/Sphinx等）。
- 贡献新特性/修复bug时补充文档。
- 重要接口建议配套示例和FAQ。

### 可扩展性建议
- 支持更多批量操作（如标签合并/转移/重命名）可用 action 参数、命令模式、插件机制。
- 批量操作逻辑可解耦为独立服务。
- 操作类型和参数建议在OpenAPI中详细说明。 